<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Workflow Improvements</title>
<meta name="author" content="(Edmund Miller)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/theme/white.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<section id="slide-org36ca036">
<h2 id="org36ca036">Functional Genomics Documentation</h2>
<div class="outline-text-2" id="text-org36ca036">
</div>
</section>
<section id="slide-orgf40be26">
<h3 id="orgf40be26">Goals</h3>
<ul>
<li>Protocols all in one place</li>
<li>Updating protocols quickly</li>
<li>Better on boarding for new lab members</li>
<li>Retaining knowledge when people move on</li>

</ul>
</section>
<section id="slide-org9c23331">
<h3 id="org9c23331">Functional Genomics GitLab</h3>
<ul>
<li><a href="https://gitlab.com/functional-genomics">https://gitlab.com/functional-genomics</a></li>
<li><a href="https://functional-genomics.gitlab.io/docs/">Docs</a></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgbf3b532">
<h2 id="orgbf3b532">Open Protocols</h2>
<div class="outline-text-2" id="text-orgbf3b532">
</div>
</section>
<section id="slide-org5477de7">
<h3 id="org5477de7">Highlights</h3>
<ul>
<li>Markdown</li>
<li>Collaboration through Git</li>
<li>Automatic Deployment</li>
<li><a href="https://star-protocols.cell.com/protocols">Star-protocols</a></li>

</ul>
</section>
<section id="slide-orgc96a385">
<h3 id="orgc96a385">Markdown</h3>
<div class="outline-text-3" id="text-orgc96a385">
</div>
</section>
<section id="slide-org896a8dd">
<h4 id="org896a8dd">Intro</h4>
<ul>
<li><a href="https://commonmark.org/">https://commonmark.org/</a></li>

</ul>
<div class="org-src-container">

<pre  class="src src-markdown"><code trim><span style="color: #ff6c6b; font-weight: bold;"># </span><span style="color: #ff6c6b; font-weight: bold;">Heading 1</span>
<span style="color: #5B6268;">*</span><span style="color: #a9a1e1; font-style: italic;">Italic</span><span style="color: #5B6268;">*</span>
<span style="color: #5B6268;">**</span><span style="color: #da8548; font-weight: bold;">Bold</span><span style="color: #5B6268;">**</span>

<span style="color: #ff6c6b; font-weight: bold;">## </span><span style="color: #ff6c6b; font-weight: bold;">Heading 2</span>
<span style="color: #ff6c6b;">-</span> List
<span style="color: #ff6c6b;">-</span> List
<span style="color: #ff6c6b;">-</span> List

<span style="color: #ff6c6b; font-weight: bold;">### Heading 3</span>
<span style="color: #5B6268;">---</span>

<span style="color: #5B6268; background-color: #2e3138;">```</span><span style="color: #ECBE7B; background-color: #2e3138;">python</span>
<span style="color: #5B6268; background-color: #2e3138;"># </span><span style="color: #5B6268; background-color: #2e3138;">code block</span>
<span style="color: #51afef; background-color: #2e3138;">print</span><span style="background-color: #2e3138;"> </span><span style="color: #98be65; background-color: #2e3138;">'3 backticks or'</span>
<span style="color: #51afef; background-color: #2e3138;">print</span><span style="background-color: #2e3138;"> </span><span style="color: #98be65; background-color: #2e3138;">'indent 4 spaces'</span>
<span style="color: #5B6268; background-color: #2e3138;">```</span>
</code></pre>
</div>
</section>
<section id="slide-org3275500">
<h3 id="org3275500">Collaboration through Git</h3>
<div class="outline-text-3" id="text-org3275500">
</div>
</section>
<section id="slide-org8aab03a">
<h4 id="org8aab03a">Intro to Git</h4>
<ul>
<li><a href="https://happygitwithr.com/">happy git with r</a></li>

<li><a href="https://learnxinyminutes.com/docs/git/">Learn git in y</a></li>
<li><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004668">Plos Computational Biology Paper</a></li>

</ul>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">git</span> clone https://gitlab.com/functional-genomics/docs.git
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Adds all the files in the current directory</span>
<span style="color: #ECBE7B;">git</span> add .
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Creating a commit message</span>
<span style="color: #ECBE7B;">git</span> commit -m <span style="color: #98be65;">"A commit message"</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Pushing to the remote repo</span>
<span style="color: #ECBE7B;">git</span> push origin master
</code></pre>
</div>
</section>
<section id="slide-org3e14167">
<h4 id="org3e14167">Why should you use git?</h4>
<ul>
<li>It’s a super save button that lets you create snapshots/backups of your work.</li>
<li>Lets you work on multiple versions of a project simultaneously – i.e. create a
new step in the pipeline, and change the tool used for alignment in another
and merge them to the main branch when ready</li>
<li>It’s amazing for collaboration and keeps things organized.</li>

</ul>
</section>
<section id="slide-org53f0653">
<h4 id="org53f0653">pre-commit</h4>
<ul>
<li><a href="https://pre-commit.com/">https://pre-commit.com/</a></li>
<li>Runs before <code>git commit</code></li>
<li>Makes everyone follow the rules</li>
<li>Code Formatting(<a href="https://www.shellcheck.net/">shellcheck</a>, <a href="https://github.com/psf/black">black</a>, <a href="https://styler.r-lib.org/">styler</a>)</li>
<li>Commit Formatting</li>

</ul>
</section>
<section id="slide-orgfefc92b">
<h4 id="orgfefc92b">Conventional Commits</h4>
<p>
Format:
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>&lt;type&gt;<span style="color: #51afef;">[</span>optional scope<span style="color: #51afef;">]</span>: &lt;description&gt;

<span style="color: #51afef;">[</span>optional body<span style="color: #51afef;">]</span>

<span style="color: #51afef;">[</span>optional footer<span style="color: #c678dd;">(</span>s<span style="color: #c678dd;">)</span><span style="color: #51afef;">]</span>
</code></pre>
</div>
<p>
Example:
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>feat: use poetry instead of conda
</code></pre>
</div>

<ul>
<li>Changelogs automatically generated</li>
<li><a href="https://semver.org/">https://semver.org/</a></li>

</ul>
</section>
<section id="slide-org5f99063">
<h3 id="org5f99063">CI/CD</h3>
<ul>
<li>Continuous Integration</li>
<li>Continuous Deployment</li>

</ul>
</section>
<section id="slide-orgfcb4da0">
<h4 id="orgfcb4da0">Features</h4>
<ul>
<li>Deploys Website whenever pushed to master</li>
<li>Checks merge requests for correct formatting</li>
<li>Creates PDFs of pages for Web lab use</li>

</ul>
</section>
<section id="slide-org12f7b6f">
<h4 id="org12f7b6f">GitLab</h4>
<ul>
<li>Password Authetication for Website</li>
<li>CI configured in yaml</li>
<li>Support for GitHub in the future</li>

</ul>
</section>
<section id="slide-orgf41160d">
<h3 id="orgf41160d">Create Your Own!</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>cookiecutter gl:functional-genomics/open-protocols/cookiecutter-open-protocol
</code></pre>
</div>
</section>
<section id="slide-orgfe436ee">
<h4 id="orgfe436ee">Fill in your lab info</h4>
<a href="https://asciinema.org/a/5Hv2mtnYBJQ74u4MzMOwOl1yh" target="_blank"><img src="https://asciinema.org/a/5Hv2mtnYBJQ74u4MzMOwOl1yh.svg" /></a>
</section>
<section id="slide-orgd40e855">
<h4 id="orgd40e855">Workflow</h4>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">make</span> install
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Serving locally http://127.0.0.1:8000/</span>
<span style="color: #ECBE7B;">make</span> serve
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org7888d96">
<h2 id="org7888d96">Nix development</h2>
<div class="outline-text-2" id="text-org7888d96">
</div>
</section>
<section id="slide-orgb5ed197">
<h3 id="orgb5ed197">Managing R environments</h3>
<ul>
<li>Reproducible R enviroments</li>
<li><a href="https://nixos.wiki/wiki/R">https://nixos.wiki/wiki/R</a></li>
<li><a href="https://nixos.org/nixos/packages.html?channel=nixpkgs-unstable">https://nixos.org/nixos/packages.html?channel=nixpkgs-unstable</a></li>

</ul>
</section>
<section id="slide-orga193c9b">
<h3 id="orga193c9b">Installing nix</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">curl</span> https://nixos.org/nix/install | sh
</code></pre>
</div>
</section>
<section id="slide-org3344ec0">
<h3 id="org3344ec0">nix-shell for R</h3>
<p>
<code>shell.nix</code>
</p>
<div class="org-src-container">

<pre  class="src src-nix"><code trim><span style="color: #51afef;">let</span>
  <span style="color: #dcaeea;">pkgs</span> = <span style="color: #c678dd;">import</span> <span style="color: #a9a1e1;">&lt;nixpkgs&gt;</span> { };
  <span style="color: #dcaeea;">stdenv</span> = pkgs.stdenv;
<span style="color: #51afef;">in</span> with pkgs; {
  <span style="color: #dcaeea;">myProject</span> = stdenv.mkDerivation {
    <span style="color: #dcaeea;">name</span> = <span style="color: #98be65;">"bioinformatics-pipeline"</span>;
    <span style="color: #dcaeea;">version</span> = <span style="color: #98be65;">"1"</span>;

    <span style="color: #dcaeea;">buildInputs</span> =
      <span style="color: #5B6268;"># Any package available in CRAN</span>
      [ R rPackages.edgeR rPackages.RColorBrewer tidyverse ];
  };
}
</code></pre>
</div>
</section>
<section id="slide-org80bfc8c">
<h3 id="org80bfc8c">nix-shell</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>$ nix-shell
<span style="color: #51afef;">[</span>nix-shell:~/src/fg/presentations/Functional_Genomics/2020-02-05<span style="color: #51afef;">]</span>$ R
&gt;
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org1f7f0dd">
<h2 id="org1f7f0dd">New and improved Snakemake</h2>
<div class="outline-text-2" id="text-org1f7f0dd">
</div>
</section>
<section id="slide-org8c359e9">
<h3 id="org8c359e9">Plain R vs Snakemake example</h3>
<p>
Coming soon!
</p>
</section>
<section id="slide-orgb16f990">
<h3 id="orgb16f990">Cookiecutter</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>cookiecutter gl:functional-genomics/cookiecutter-snakemake-workflow
</code></pre>
</div>
<ul>
<li>Fill in your info and get started!</li>

</ul>
</section>
<section id="slide-orge71eca4">
<h3 id="orge71eca4">Before</h3>
<p>
Setup
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
<span style="color: #ECBE7B;">cd</span> project/dir
conda env create -f environment.yml
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Get Coffee while waiting on conda</span>
</code></pre>
</div>
<p>
Workflow
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>conda activate smk
<span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
snakemake --use-conda --use-singularity
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Rerunning a specific rule</span>
snakemake --use-conda --use-singularity -R bowtie2
snakemake --report report.html
</code></pre>
</div>
</section>
<section id="slide-org16d4f74">
<h3 id="org16d4f74">After</h3>
<p>
Setup
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
<span style="color: #ECBE7B;">make</span> install
<span style="color: #ECBE7B;">make</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Or specific rules</span>
<span style="color: #ECBE7B;">make</span> smk <span style="color: #dcaeea;">rule</span>=bowtie2
<span style="color: #ECBE7B;">make</span> report
</code></pre>
</div>
</section>
<section id="slide-orgdccbe45">
<h3 id="orgdccbe45">Cluster</h3>
<div class="outline-text-3" id="text-orgdccbe45">
</div>
</section>
<section id="slide-org03f5113">
<h4 id="org03f5113">Before</h4>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">mkdir</span> -p ~/.config/snakemake
<span style="color: #ECBE7B;">cd</span> ~/.config/snakemake
cookiecutter https://github.com/Snakemake-Profiles/slurm.git
<span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
activate singularity
snakemake --profile slurm --use-conda --use-singularity
snakemake --profile slurm --use-conda --use-singularity -R bowtie2
</code></pre>
</div>
</section>
<section id="slide-orgd7caf76">
<h4 id="orgd7caf76">After</h4>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
<span style="color: #ECBE7B;">make</span> profile
<span style="color: #ECBE7B;">make</span> slurm
<span style="color: #ECBE7B;">make</span> slurm <span style="color: #dcaeea;">rule</span>=bowtie2
</code></pre>
</div>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
